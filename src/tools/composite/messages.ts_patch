<<<<<<< SEARCH
import { listFolders, modifyFlags, moveEmails, readEmail, searchEmails, trashEmails } from '../helpers/imap-client.js'

export interface MessagesInput {
=======
import { listFolders, modifyFlags, moveEmails, readEmail, searchEmails, trashEmails } from '../helpers/imap-client.js'

// Simple in-memory cache for archive folder paths to avoid repeated IMAP calls
const archiveFolderCache = new Map<string, string>()

export interface MessagesInput {
>>>>>>> REPLACE
<<<<<<< SEARCH
  // Detect archive folder based on provider
  let archiveFolder = '[Gmail]/All Mail'
  if (account.imap.host.includes('office365') || account.imap.host.includes('outlook')) {
    archiveFolder = 'Archive'
  } else if (account.imap.host.includes('yahoo')) {
    archiveFolder = 'Archive'
  }

  // Try to find actual archive folder
  try {
    const folders = await listFolders(account)
    const found = folders.find(
      (f) =>
        f.path.toLowerCase().includes('archive') ||
        f.path.toLowerCase().includes('all mail') ||
        f.flags.some((flag) => flag.toLowerCase().includes('archive') || flag.toLowerCase().includes('all'))
    )
    if (found) {
      archiveFolder = found.path
    }
  } catch {
    // Use default if folder listing fails
  }

  const result = await moveEmails(account, uids, folder, archiveFolder)
=======
  // Check cache first
  let archiveFolder = archiveFolderCache.get(account.id)

  if (!archiveFolder) {
    // Detect archive folder based on provider
    archiveFolder = '[Gmail]/All Mail'
    if (account.imap.host.includes('office365') || account.imap.host.includes('outlook')) {
      archiveFolder = 'Archive'
    } else if (account.imap.host.includes('yahoo')) {
      archiveFolder = 'Archive'
    }

    // Try to find actual archive folder
    try {
      const folders = await listFolders(account)
      const found = folders.find(
        (f) =>
          f.path.toLowerCase().includes('archive') ||
          f.path.toLowerCase().includes('all mail') ||
          f.flags.some((flag) => flag.toLowerCase().includes('archive') || flag.toLowerCase().includes('all'))
      )
      if (found) {
        archiveFolder = found.path
      }
    } catch {
      // Use default if folder listing fails
    }

    // Cache the result
    archiveFolderCache.set(account.id, archiveFolder)
  }

  const result = await moveEmails(account, uids, folder, archiveFolder)
>>>>>>> REPLACE
